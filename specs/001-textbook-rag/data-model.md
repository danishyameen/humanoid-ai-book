# Data Model: AI-Native Textbook with RAG Chatbot

**Date**: 2025-12-07
**Feature Spec**: specs/001-textbook-rag/spec.md

## Entities

### 1. Textbook Content

**Description**: Represents a section or sub-section of the textbook's structured content.

**Attributes**:
-   `id`: Unique identifier (Primary Key, UUID)
-   `chapter_number`: Integer (e.g., 1-6), identifies the main chapter.
-   `section_id`: String (e.g., "introduction-to-physical-ai", "ros-fundamentals-basics"), unique slug within its parent chapter.
-   `title`: String (e.g., "Introduction to Physical AI"), human-readable title.
-   `markdown_content`: String, the raw Markdown text for the section.
-   `metadata`: JSONB (key-value pairs for author, tags, creation_date, last_modified_date, etc.).
-   `version`: String, version of the content (e.g., "1.0.0").
-   `parent_section_id`: Optional String, foreign key to `Textbook Content.section_id` for hierarchical organization.
-   `urdu_translation_id`: Optional UUID, foreign key to `Textbook Content.id` (self-referential) for the Urdu translated version of this content.
-   `embedding_ids`: Array of UUIDs, foreign keys to `Embedding.id` (if content is chunked into multiple embeddings).

**Relationships**:
-   One-to-many with `Embedding` (one content section can be represented by multiple embeddings if chunked).
-   One-to-one (optional) with another `Textbook Content` (for translated version).
-   One-to-many (self-referential) for hierarchical sections.

**Validation Rules**:
-   `id` MUST be unique.
-   `chapter_number` MUST be a positive integer within the defined range (1-6).
-   `section_id` MUST be unique within its `chapter_number` and `parent_section_id`.
-   `title` MUST NOT be empty.
-   `markdown_content` MUST NOT be empty.

### 2. Embedding

**Description**: Represents a vector embedding of a specific text chunk from the `Textbook Content`.

**Attributes**:
-   `id`: Unique identifier (Primary Key, UUID)
-   `vector`: Array of Floats, the high-dimensional vector embedding.
-   `source_text_chunk`: String, the exact segment of text from which the embedding was generated.
-   `textbook_content_id`: UUID, Foreign Key to `Textbook Content.id`, linking to the original content section.
-   `embedding_model_info`: String (e.g., "all-MiniLM-L6-v2"), specifies the model used for embedding.
-   `chunk_order`: Integer, order of this chunk within its parent `textbook_content_id` (if content was split).

**Relationships**:
-   Many-to-one with `Textbook Content`.

**Validation Rules**:
-   `id` MUST be unique.
-   `vector` MUST NOT be empty and MUST contain float values.
-   `source_text_chunk` MUST NOT be empty.
-   `textbook_content_id` MUST reference an existing `Textbook Content` entry.

### 3. User Query

**Description**: Represents a question submitted by a user to the RAG chatbot.

**Attributes**:
-   `id`: Unique identifier (Primary Key, UUID)
-   `text`: String, the user's natural language question.
-   `timestamp`: Datetime, when the query was submitted.
-   `context_text`: Optional String, text selected by the user to provide additional context for the query.
-   `session_id`: Optional UUID, links queries to a user's session for conversational context.

**Relationships**:
-   One-to-many with `Chatbot Response`.

**Validation Rules**:
-   `id` MUST be unique.
-   `text` MUST NOT be empty.

### 4. Chatbot Response

**Description**: Represents the answer generated by the RAG system in response to a `User Query`.

**Attributes**:
-   `id`: Unique identifier (Primary Key, UUID)
-   `query_id`: UUID, Foreign Key to `User Query.id`.
-   `answer_text`: String, the generated answer.
-   `source_references`: Array of Strings, direct references (e.g., "Chapter 3, Section 2") to the textbook content that informed the answer.
-   `timestamp`: Datetime, when the response was generated.

**Relationships**:
-   Many-to-one with `User Query`.

**Validation Rules**:
-   `id` MUST be unique.
-   `query_id` MUST reference an existing `User Query` entry.
-   `answer_text` MUST NOT be empty.
